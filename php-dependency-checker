#!/usr/bin/env php
<?php

use Rekhyt\PhpDependencyChecker\PhpDependencyCheckerCli;
use Rekhyt\PhpDependencyChecker\Vulnerability\Factory\PackageExclusionFileRepository;
use Rekhyt\PhpDependencyChecker\Vulnerability\Factory\VulnerabilitySLApiRepository;
use Rekhyt\PhpDependencyChecker\Vulnerability\Factory\ComposerLockFileContentFileRepository;

$require = true;
if (class_exists('Phar')) {
    try {
        Phar::mapPhar('php-dependency-checker.phar');
        require_once 'phar://php-dependency-checker/vendor/autoload.php';
        $require = false;
    } catch (PharException $e) {
    }
}
if ($require) {
    if (file_exists(__DIR__ . '/../../autoload.php')) {
        require_once __DIR__ . '/../../autoload.php';
    } else {
        require_once __DIR__ . '/vendor/autoload.php';
    }
}
unset($require);

$cli = new PhpDependencyCheckerCli(
    new VulnerabilitySLApiRepository(),
    new ComposerLockFileContentFileRepository(),
    new PackageExclusionFileRepository()
);

try {
    $cli->run();
} catch (Exception $e) {
    $cli->fatal($e);
}

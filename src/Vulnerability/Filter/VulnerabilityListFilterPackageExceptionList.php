<?php
/**
 * Copyright (c) 2017 Timo Ebel
 *
 * This work is licensed under the terms of the MIT license.
 * For a copy, see <https://opensource.org/licenses/MIT> or the LICENSE file included in this project.
 */

namespace Rekhyt\PhpDependencyChecker\Vulnerability\Filter;

use Rekhyt\PhpDependencyChecker\Vulnerability\ValueObject\PackageName;

/**
 * Filters a list of vulnerability entities against a list of packages to be ignored.
 */
class VulnerabilityListFilterPackageExceptionList implements VulnerabilityListFilter
{
    /** @var PackageName[] */
    private $packageExceptionList;

    /** @var array [string, bool] */
    private $packageExceptionMap;

    /**
     * @param PackageName[] $packageExceptionList
     */
    public function __construct(array $packageExceptionList)
    {
        $this->packageExceptionList = $packageExceptionList;

        $this->packageExceptionMap = [];
        foreach ($packageExceptionList as $packageName) {
            $this->packageExceptionMap[$packageName->getValue()] = true;
        }
    }

    /** @inheritdoc */
    public function filter(array $vulnerabilities)
    {
        $filteredVulnerabilities = [];
        foreach ($vulnerabilities as $vulnerability) {
            if (isset($this->packageExceptionMap[$vulnerability->getPackageName()->getValue()])) {
                continue;
            }
            
            $filteredVulnerabilities[] = $vulnerability;
        }

        return $filteredVulnerabilities;
    }
}
